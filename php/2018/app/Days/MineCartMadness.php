<?php

namespace PatrickRose\AdventOfCode\Days;

class MineCartMadness extends AbstractDay
{

    const LEFT = 0;
    const DOWN = 1;
    const RIGHT = 2;
    const UP = 3;

    protected function getPuzzleInput(): string
    {
        return <<<INPUT
                      /---------------------\           /----------------<---------------------------------------------------------------------\      
                      |                     |           |         /---------------------------\                                                |      
              /-------+---------------------+-----------+---------+---------------------------+------\                                         |      
   /----------+-------+---------------------+---\      /+---------+---------------------------+------+------\                                  |      
 /-+----------+-------+---------------------+---+------++---------+-------------------------\ |      |      |                                  |      
 | |          |       |  /------------------+---+------++---------+-----\                   | | /----+------+---------------------------\      |      
 | |   /------+-------+--+------------------+---+-\    ||         |     |              /----+-+-+----+------+----------------\          |      |      
 | |   |      | /-----+--+------------------+---+-+----++---------+-----+--------------+----+-+-+----+---\  |                |          |      |      
 | |   |      | |    /+--+--------------\   |   | |    ||    /----+-----+--------------+----+-+-+----+---+--+----------------+---------\|      |      
 | |   |      | |    ||  |              |   |   | |    ||    |    |     |              |    | | |    |   |  |                |         ||      |      
 | |   |      | |    ||  |      /-------+---+-\ | |    ||    |    |     |              |    | | |    |   |  |        /-------+---------++------+---\  
 | |   |      | |    ||  |      |       |   | | | |    ||    |    |     |     /--------+----+-+-+----+---+\ |        |       |         ||      |   |  
 | |   |      | |    ||  |      |       |   | | | |    ||    |/---+-----+\    |        |    | | |    |   || |        |       |         ||      |   |  
 | |   |    /-+-+----++--+------+-------+---+-+-+-+----++----++---+-----++--->+--------+----+-+-+----+---++-+-----\  |       |         ||      |   |  
 | |   |    | | |   /++--+------+-------+---+-+-+-+----++----++---+-----++----+--------+----+-+-+----+---++-+-----+--+-------+-\       ||      |   |  
 | |  /+----+-+-+---+++--+------+-------+---+-+-+-+----++-\  ||   |     ||    |        |    | | |    |   || |     |  |       | |       ||      |   |  
 | |  ||    | | |   |||  |      |       |   | | | |    || | /++---+-----++----+--------+----+-+-+-\  |   || |     |  |       | |       ||      |   |  
 | |  ||    |/+-+---+++--+------+-------+---+-+-+-+----++-+-+++---+\  /-++----+--\     |    | | | |  |   || |     |  |       | |/------++--\   |   |  
 | |  ||    ||| |/--+++--+------+-------+---+-+-+-+----++\| |||   ||  | ||    |  | /---+----+-+-+-+--+---++-+----\|  |       | ||      ||  |   |   |  
 | |  ||    ||| ||  |||  |/-----+-------+---+-+-+-+----++++-+++---++--+-++----+--+-+---+----+-+-+-+--+---++-+----++--+-------+-++---\  ||  |   |   |  
 | |  ||    ||| ||  |\+--++-----+-------/   | | | |    |||| |||   v|  | ||    |  | |   |    | | | |  |/--++-+----++--+-------+-++---+--++--+---+--\|  
/+-+--++----+++-++--+-+--++-----+-----------+-+-+-+----++++-+++---++--+-++----+--+-+-\ \----+-+-+-+--++--++-+----++--+-------/ ||   |  ||  |   |  ||  
|| | /++----+++-++--+-+--++-----+-----------+-+-+-+----++++-+++---++--+-++---\|  | | |      | | | |  ||  || |    ||  |         ||   |  ||  |   |  ||  
|| | |||    ||| ||  | |  ||     |           | | | |/---++++-+++---++--+-++---++--+-+-+------+-+-+-+--++--++-+----++--+---------++--\|  ||  |   |  ||  
|| | |||/---+++-++--+-+--++-----+-----------+-+-+-++---++++-+++---++--+-++---++--+-+-+---\  | | | |  ||  || |    ||  |         ||  ||  ||  |   |  ||  
|| | ||||   ||| ||  | |  ||     |           | | | ||   |||| |||   ||  | ||/--++--+-+-+---+--+-+\| |  ||  || |    ||  |         ||  ||  ||  |   |  ||  
|| | ||||   ||| || /+-+--++-----+-----------+-+-+-++---++++-+++---++--+-+++--++--+-+-+---+--+-+++-+--++--++-+----++--+-------\ ||  ||  ||  |   |  ||  
|| | ||||   ||| \+-++-+--++-----+-----------+-+-+-++---++++-+++---++--+-+++--++--+-+-+---+--+-+++-+--++--/| |    ||  \-------+-++--++--++--+---+--+/  
|| | ||||   |||  |/++-+--++-----+-----------+-+-+-++---++++-+++---++--+-+++\ ||  | | |   |  | ||| |  ||   | |    ||          | ||  ||  ||  |   |  |   
|| | ||||   |||  |||| |  ||     |           | | | ||   |||| |||   ||  | |||| ||  | | |   |  | ||| |  ||   | |    ||          | ||  ||  ||  |   |  |   
|| |/++++---+++--++++-+--++---\ |           | | | ||   |||| |||   ||/-+-++++-++--+-+-+---+--+-+++-+--++---+-+----++----------+-++--++--++--+---+--+\  
|| ||||||   |||  |||| |  ||   | |           | | | ||   |||| |\+---+++-+-++++-++--+-+-+---+--+-+++-+--++---+-+----++----------+-++--++--/|  |   |  ||  
|| ||||||   |||  |||| |  ||   | |  /--------+-+-+-++---++++-+-+---+++-+-++++-++--+-+-+---+-\| ||| |  ||   | |    ||          | ||  ||   |  |   |  ||  
|| ||||||   |||  |||| | /++---+-+--+--------+-+-+-++---++++-+-+---+++-+-++++-++--+-+-+---+-++-+++-+--++-\ | |    || /--------+-++--++---+--+\  |  ||  
|| ||||||   |||  |||| | |||   | |  |   /----+-+-+-++---++++-+-+---+++-+-++++-++--+-+-+---+-++-+++-+--++-+-+-+----++-+--------+-++--++---+--++--+-\||  
|| ||||||   |||  |||| | |||   | |  |   |    | | | ||  /++++-+-+--\||| | |||| ||  |/+-+---+-++-+++-+--++-+-+-+----++-+--------+-++--++---+--++-\| |||  
|| ||||||   |||  |||| | |||  /+-+--+---+----+-+-+-++--+++++-+-+--++++-+-++++-++--+++-+---+-++-+++-+--++-+-+-+----++-+--\     | ||  ||   |  || || |||  
|| |||||| /-+++--++++-+-+++--++-+--+---+----+-+\| ||  ||||| | |  |||| | |||| ||  ||| |   | || ||| |  || | | |    || |  |   /-+-++--++---+\ || || |||  
|| |||||| | |||  |||| \-+++--++-+--+---+----/ ||| ||  ||||| | |  |||| | |||| ||  ||| |   | || ||| |  || | | |    || |  |   | | ||  ||   || || || |||  
|| ||||\+-+-+++--++++---+++--++-+--+---+>-----+++-/|  ||||| | |  |||\-+-++++-++--+++-+---+-++-+++-+--++-+-+-+----++-+--+---+-+-++--++---++-++-++-++/  
|| |||| | | |||  ||||   |||  || |  |   |/-----+++--+--+++++-+-+--+++--+-++++-++--+++-+---+-++-+++-+--++-+-+-+-\  || |  |   | | ||  ||   || || || ||   
|| |||| | | |||  |\++---+++--++-+--+---++-----+++--+--+++++-+-+--+++--+-+++//++--+++-+---+-++-+++-+--++-+-+-+-+--++-+--+---+\| ||  ||   || || || ||   
|| |||| | | |||  | |\---+++--++-+--+---++-----+++--+--+++++-+-+--+++--+>+++-+++--+++-+---+-++-+++-+--++-+-+-+-+--++-+--+---+++-/|  ||   || || || ||   
|| |||| | | |||  | |    |||  || |  | /-++-----+++--+--+++++-+-+--+++--+-+++-+++--+++-+---+-++-+++-+--++-+-+-+-+--++-+--+---+++--+--++-<-++-++-++\||   
|| |||\-+-+-+++--+-+----+++--++-+--+-+-++-----+++--+--++++/ | |  |||  | ||| |||  ||| |   | || ||| |  || |/+-+-+--++-+--+---+++--+--++---++-++-+++++\  
|| |||  | | |||  | |    |||  || |  | | ||     |||  |  ||||  \-+--+++--+-+++-+++--+++-+---+-++-+++-/  || ||| | |  || |  |   |||  |  ||   || || ||||||  
|| |||  | | |||  | |    |||  || |  | | ||/----+++--+--++++----+\ |||  | ||| |||  |||/+---+-++-+++----++-+++-+-+--++-+--+---+++--+--++--\|| || ||||||  
|| |||  | | |||  | |    |||  || |  |/+-+++----+++--+--++++----++-+++--+-+++-+++--+++++---+-++-+++----++-+++-+-+--++-+--+---+++-\|  ||  ||| || ||||||  
|| \++--+-+-+++--+-+----+++--++-+--+++-+++----++/  |  ||||    || |||  \-+++-+++--/||||   | || |||    || ||| | |  || |  |   ||| ||  ||  ||| || ||||||  
||  ||  | | |||  | |    |||  || |  ||| |||    ||   |  ||||    || |||    ||| ||\---++++---+-++-+++----++-++/ | |  || |  |   ||| ||  ||  ||| || ||||||  
||  ||  | | |||  | |    |||  || |  ||| |||    ||   |  ||||    \+-+++----+/| \+----++++---+-++-+++----++-++--+-+--++-+--+---+/| ||  ||  ||| || ||||||  
||  || /+-+-+++--+-+----+++--++-+--+++-+++----++---+--++++-----+-+++----+-+--+----++++---+\|| |||    || ||  | |  || \--+---+-+-++--++--+++-+/ ||||||  
||  || || | |||  | |   /+++--++-+--+++-+++----++---+--++++-----+-+++----+-+--+----++++---++++-+++----++-++--+-+--++--\ |   | | ||  ||  ||| |  ||||||  
||  || || | |||  | |   ||||  || |  ||| |||    ||   |  ||||     | |\+----+-+--+----++++---++++-/||    || ||  | |  ||  | |   | | ||  ||  ||| |  ||||||  
||  || || | |||  | |  /++++--++-+--+++-+++----++---+--++++-----+-+-+----+-+--+----++++---++++--++----++-++--+-+--++--+-+---+-+-++-\||  ||| |  ||||||  
||  || || | |||  | |  |||||  || |  ||| |||    ||   |  ||||     | | |    | |  |    ||||   |||| /++----++-++--+-+--++--+\|   |/+-++-+++\ ||| |  ||||||  
||  || || | |||  | |  |||||  || |  ||| |||    ||   |/-++++-----+-+-+----+-+--+----++++---++++-+++\   || ||  | |  ||  |||   ||| || |||| ||| |  ||||||  
||  || || | |||  | | /+++++--++-+--+++<+++----++---++-++++-----+-+-+----+-+--+----++++---++++-++++---++-++--+\|  ||  |||   ||| || |||| ||| |  ||||||  
||  || || | |||  | | ||||||  || |  |\+-+++----++---++-++++-----+-+-+----+-+--+----++++---++++-++++---++-++--+++--++--+++---+++-/| |||| ||| |  ||||||  
||  || || | |||  | | |||\++--++-+--+-+-+++----++---++-++++-----+-+-+----+-+--+----++++---++++-++++---++-/|  |||  ||  |||   |||  | |||| ||| |  |^||||  
||  || || | |||  | |/+++-++--++-+--+-+-+++----++---++-++++-----+-+-+----+-+--+----++++\  |||| ||||   |\--+--+++--++--+++---+++--+-++++-+++-+--++++/|  
||  || || | |||  | ||||| ||  || |  | | |||    ||   || ||||     | | |    | |  |    ||\++--++++-++++---+---+--+++--++--+++---+++--+-++++-/|| |  |||| |  
||  || || | |||  | ||||| ||  || |  | | |||    ||   || ||||     | | |    | |  |    || ||  |||| ||||   |   |  |||  ||  |||   |||  | ||||  || |  |||| |  
||  || || | \++--+-+++++-++--++-+--+-+-+++----++---++-++++-----+-+-+----+-+--+----++-++--++++-++++---+---+--+++--+/  |||   |||  | ||||  || |  |||| |  
||  || || |  ||  | ||||| ||  || |  | | |||    ||   || ||||     | | |    | |  |    || ||  |||| ||||   |   |  |||  |   |||   |||  | ||||  || |  |||| |  
||  ||/++-+--++--+-+++++-++--++-+--+-+-+++----++---++-++++-----+-+-+----+-+--+----++-++\ |||| ||||   |   |  |||  |   |||   |||  | ||||  || |  |||| |  
||  \++++-+--++--+-+++++-++--+/ |  | | ||| /--++---++-++++-----+-+-+----+-+--+----++-+++-++++-++++>--+---+--+++--+---+++---+++--+\||||  || |  |||| |  
||   |||| |  ||  | ||||| |\--+--+--+-+-+++-+--++---++-++++-----+-+-+----+-+--+----++-+++-++++-++++---+---+--+++--+---+++---+++--++++/|  || |  |||| |  
||   |||| |  ||  | ||||| |   |  |  | | ||\-+--++---++-++++-----/ | |    |/+--+----++-+++\|||| ||||   |/--+--+++--+---+++---+++--++++-+--++-+-\|||| |  
||   |||| |  ||  | ||||| |   |  |  | | ||  |/-++---++-++++-------+-+----+++--+----++-++++++++-++++---++--+--+++--+---+++---+++--++++-+--++\| ||||| |  
||   |||| |  ||  | ||||| | /-+--+--+-+-++--++-++---++-++++-------+-+----+++--+----++-++++++++-++++---++--+--+++\ |   |||   |||  |||| |  |||| ||||| |  
|\---++++-+--++--+-+++++-+-+-+--+--+-+-++--++-++---++-++++-------+-+----+++--+----++-+++++++/ ||||   ||  |  |||| |   |||   |||  |||| |  |||| ||||| |  
|    |||\-+--++--+-+++++-+-+-+--+--+-+-++--++-++---++-++++-------+-+----+++--+----++-++++/||  ||||   ||  |  |||| |   |||   |||  |||| |  |||| ||||| |  
|    |||/-+--++--+-+++++-+-+-+--+--+-+-++--++-++---++-++++-------+-+-\  |||  |    || |||| ||  ||||   ||  |  |||| |   |||   |||  |||| |  |||| ||||| |  
|    |||| |  ||  | ||||| | | |  |  | | ||  || ||   |\-++++-------+-+-+--+++--+----++-++++-++--+++/   ||  |  |||| |   |||   |||  \+++-+--+++/ ||||| |  
|    |||| |  ||  | ||||| | | |/-+--+-+-++--++-++---+--++++-------+-+-+--+++--+----++-++++-++--+++----++--+--++++\|   |||   |||   ||| |  |||  ||||| |  
|    |||| |  ||  | ||||| | | || |  | | ||  || || /-+--++++-------+-+-+--+++--+--\ || |||| ||  |||    ||  |  ||||||   |||   |||   ||| |  |||  ||||| |  
|    |||| |  ||  | ||||| \-+-++-+--+-+-++--++-++-+-+--++++-------+-+-+--/||  |  | || |||| ||  |||    ||  |  ||||||   |||   |||   ||| |  |||  ||||| |  
|    |||| |  ||  | |||||   | || |  | | ||  || || | |  |||| /-----+-+-+---++--+--+-++-++++-++--+++----++--+--++++++---+++---+++\  ||| |  |||  ||||| |  
|    |||| |  \+--+-+++++---+-++-+--+-+-++--++-++-+-+--++++-+-----+-/ |   ||  |  | || |||| ||  |||   /++--+--++++++\  |||   |||| /+++-+--+++\ ||||| |  
|    |||| \---+--+-+++++---+-++-+--+-+-++--++-+/ v |  |\++-+-----+---+---++--+--+-++-++++-++--+++---+++--+--/||||||  |||   |||| |||| |  |||| ||||| |  
|    ||||  /--+--+-+++++--\|/++-+--+-+-++--++-+--+-+--+-++-+-----+---+---++--+--+-++-++++-++--+++---+++--+\  ||||||  |||   |||| |||| |  |||| ||||| |  
|    ||||  |  | /+-+++++--+++++-+--+-+-++--++-+--+-+--+-++-+-----+---+---++-\|  | || |||| ||  |||   |||/-++--++++++-\|||   |||| |||| |  |||| ||||| |  
|    ||||  |  | || |||||  ||||| |  | | ||  || |  | |  | || |/----+---+---++-++--+-++-++++-++--+++---++++-++--++++++-++++\  |||| |||| |  |||| ||||| |  
\----++++--+--+-++-+++++--+++++-+--+-+-++--++-+--+-+--+-++-++----+---+---++-++--+-++-/||| ||  |||   |||| ||  |||||| |||||  |||| |||| |  |||| ||||| |  
    /++++--+--+-++-+++++\ |||\+-+--+-+-++--++-+--+-+--+-++-++----+---+---++-++--+-++--+++-++--+++---++++-++--++++++-+++/|  |||| |||| |  |||| ||||| |  
    |||||/-+--+-++-++++++-+++-+-+-\| \-++--++-+--+-+--+-++-++----+---+---++-++--+-++--+++-++--+++---++++-++--++++++-+++-+--++++-++++-+--++++-+++/| |  
    |||||| |  | || |||||| |\+-+<+-++---++--++-+--+-+--+-++-++----+---+---++-++--+-++--+++-++--+++---++++-++--++/||| ||| |  |||| |||| |  |||| ||| | |  
    |||||| |  | || |||||| | | \-+-++---++--++-+--+-+--+-++-++----+---+---++-++--+-++--+++-++--+++---++++-++--++-/|| ||| |  |||| |||| |  |||| ||| | |  
    |||||| |  | || |||||| | |   | ||   ||  || |  \-+--+-++-++----+---+---++-++--/ ||  ||| ||  |||   |||| ||  ||  || ||| |  |||| |||| |  |||| ||| | |  
    |||||| |  | || |||\++-+-+---+-++---++--++-+----+--+-++-++----+---+---++-++----++--+++-++--+++---++++-++--++--++-+++-+--++++-++/| |  |||| ||| | |  
    |||||| |  |/++-+++-++-+-+---+-++---++--++-+----+--+-++-++----+---+---++-++----++--+++-++\ |||   |||| ||  ||  || ||| |  |||| || | |  |||| ||| | |  
    |||||| |  |||| ||| || | |   | |\---++--++-+----+--+-++-++----+---+---++-++----++--+++-+/| |||   |||| ||  ||  || ||| |  |||| || | |  |||| ||| | |  
    |||||| |  |||| ||| || | |   | |    ||  \+-+----+--+-++-++----+---+---++-++----++--+++-+-+-+++---++++-++--++--++-+++-+--++++-+/ | |  |||| ||| | |  
    |||||| |  |||| ||| || | |   | |    ||/--+-+----+--+-++-++---\|   |   || ||    ||  ||| | | |||   |||| ||  ||  || ||| |  |||| |  | |  |||| ||| | |  
    |||||| |  |||| ||| || | |   | |    |||  | |    |  | || ||   ||   |   || ||    ||  ||| | | ||\---++++-++--++--++-+++-+--++++-+--+-+--/||| ||| | |  
    |||||| |  |||| ||| |^ | |   | |    |||  | |    |  | || ||   ||   |   || ||    ||  |||/+-+-++----++++-++--++--++-+++\|  |||| |  | |   ||| ||| | |  
  /-++++++-+--++++\||| || | |   | |    |||  | |    |  | || ||   ||   |   \+-++----++-<++/|| | ||    |||| ||  ||  || |||||  |||| |  | |   ||| ||| | |  
  | |||||| \--++++++++-++-/ |   | |    ||| /+-+----+--+-++-++---++---+---\| || /--++--++-++-+-++----++++-++--++--++-+++++--++++-+--+\|   ||| ||| | |  
  | ||||||    |||||||| ||   |   | |    ||| || |    |  | || ||   ||   |   || || |  ||  || || | \+----++++-++--++--++-++/||  |||| |  |||   ||| ||| | |  
  | ||||||    |||||||| ||   |   | | /--+++-++-+----+--+-++-++---++---+\  || || |  \+--++-++-+--+----++++-++--++--++-++-++--++++-+--+++---+++-+/| | |  
  | ||||||    |||||||| ||   |   | | |  ||| || |    | /+-++-++---++---++--++-++-+---+--++-++-+--+----++++-++--++--++-++-++--++++-+--+++---+++-+-+-+-+\ 
  | ||||||    |||||||| ||   |   | | |  ||| || |    | || \+-++---++---++--++-++-+---+--++-++-+--+----++++-++--++--++-++-++--++++-+--+++---+++-+-/ | || 
  | ||||||    \+++++++-++---+---+-+-+--+++-++-+----+-++--+-++---++---++--++-++-+---+--++-++-+--+----+/|| ||  ||  || || ||  |||| |  |||   ||| |   | || 
  | ||||||     ||||||| ||   |   | | |  ||| || |    | ||  | ||   ||   ||  || || |   |  || || |  |    | || ||  ||  || || ||  |||| |  |||   ||| |   | || 
  | ||||||     ||||||| ||   |   | | |  \++-++-+----+-++--+-++---++---++--++-++-+---+--++-++-+--+----+-++-++--++--++-++-++--++++-+--+++---+++-+---/ || 
  | \+++++-----+++++++-+/   |   \-+-+---++-++-/    | ||  | ||   ||   ||  || || |   \--++-++-+--+----+-++-++--++--/| || ||  |\++-+--++/   ||| |     || 
  |  |v|||/----+++++++-+----+--\  | |   || ||      \-++--+-++---++---++--++-++-+------++-++-+--+----+-++-++--++---+-++-++--+-++-+--/|    ||| |     || 
  |  ||||||    \++++++-+----+--+--+-+---++-++--------++--+-++---++---++--++-++-+------++-++-/  |    | || ||  ||   | || ||  | || |   |    ||| |     || 
  |  ||||||   /-++++++-+----+--+--+-+---++-++--------++--+-++---++---++--++-++-+------++-++----+----+-++\||  ||   | || ||  | || |   |    ||| |     || 
  |  ||||||   | |||||| |    |  |  | |   \+-++--------++--+-++---++---++--++-++-+------++-++----+----+-+++++--+/   | || ||  | || |   |    ||| |     || 
  |  ||||||   | |||||| \----+--+--+-+----+-++--------++--+-++---++---++--++-++-+------++-++----+----+-+++++--+----+-+/ ||  | || |   |    ||| |     || 
  \--++++++---+-++/|||      |  |  | |    | ||        ||  | ||   ||   ||  || || |   /--++-++----+----+-+++++--+----+-+--++\ | || |   |    ||| |     || 
     ||||||   | || |||      |  |  | |    | \+--------++--+-++---++---++--/| || |   |  || ||    |    | |||||  |    | |  ||| | || |   |    ||| |     || 
     \+++++---+-++-+++------+--+--+-+----+--+--------++--+-++---++---++---+-+/ \---+--++-++----+----+-+++++--+----+-+--+++-+-++-+---/    ||| |     || 
      ||||| /-+-++-+++------+--+--+-+----+--+--------++--+-++---++---++---+-+------+--++-++----+----+-+++++--+\   | |  ||| \-++-+--------/|| |     || 
      ||||| | | || |||      \--+--+-+----+--+--------++--+-++---++---++---+-+->----+--++-++----+----+-++++/  ||   | |  |||   || |         || |     || 
      ||||| | | || |||         |  | |    |  |        |\--+-++---+/   ||/--+-+------+--++-++----+---\| |\++---++---+-/  |||   || |         || |     || 
 /----+++++-+-+-++\|||         |  | |    \--+--------+---+-++---/    |||  | |      |  || ||    |   || | |\---++---+----+++---++-+---------++-+-----/| 
 |    ||||| | | ||||||         |  | |       |        |   | ||        |||  | |      |  || ||    |   || | |    ||   |    |||   || |         || |      | 
 |    ||||| | | |\++++---------+--+-+-------+--------+---/ ||        |||  | |      |  || ||    |   || | |    ||   |    |||   || |         || |      | 
 |    ||||| | | | ||||         |  | |       |        |     ||   /----+++--+-+------+--++-++----+---++-+-+----++---+----+++---++-+------\  || |      | 
 |    ||||| | | | ||||         |  | |       |        \-----++---+----+++--+-+------+--++-++----+---++-+-+----++---+----+++---++-+------+--++-+------/ 
 |    ||||| | | | ||||         |  | \-------+--------------++---+----+/|  | |      |  || ||    |   || | |    ||   |    ||| /-++-+------+-\|| |        
 |    ||||| | | | ||||         |  |         |              \+---+----+-+--+-+------+--++-++----+---++-+-+----++---+----+++-+-+/ |      | ||| |        
 |    ||||| | \-+-++++---------+--+---------+---------------+---+----+-+--+-+------+--++-++----+---++-+-/    ||   |    ||| | |  |      | ||| |        
 |    ||||| |   | |||\---------+--+---------+---------------+---+----+-+--+-+------+--++-++----+---++-+------/|   |    ||| | |  |      | ||| |        
 |/---+++++-+---+-+++-\        |  |     /---+---------------+---+----+-+--+-+------+--++-++----+---++-+-------+---+----+++-+-+--+------+\||| |        
 \+---+++++-+---+-/|| |        |  |     |   |               |/--+----+-+--+-+------+--++-++----+---++-+-----\ |   |    ||| | |  |      ||||| |        
  |   \++++-+---+--++-+--------+--+-----+---+---------------++--+----+-+--+-+------+--+/ ||    |   || |     | |   |    ||| | |  \------++++/ |        
  |    |||| |   |  || |        |  |     |   |               ||  |    | |  \-+------+--+--++----/   || |     | |   |    ||| | |         ||||  |        
  |    |||| |   |  || |        |  |     v   |               ||  |    | |    |      |  |  \+--------++-+-----+-+---+----/|| | |         ||||  |        
  |    ||\+-+---+--++-+--------+--/     |   |               ||  |    | |    |      |  |   |        |\-+-----+-+---/     || | |         ||||  |        
  |    || | |   |  \+-+--------+--------+---+---------------++--+----+-+----+------+--+---+--------+--+----<+-+---------++-+-/         ||||  |        
  |    || | |   |   \-+--------+--------+---+---------------++--+----+-+----+------+--/   |        |  |     | |         || \-----------++/|  |        
  |    \+-+-+---+-----+--------+--------+---+---------------++--+----+-+----+------+------/        |  |     | |         ||             || |  |        
  |     | | |   |     |        |        \---+---------------++--+----+-+----+------+---------------+--+-----+-+---------++-------------+/ |  |        
  |     | | |   |     |        |            |               ||  |    | |    |      |               |  |     | |         ||             |  |  |        
  |     | | \---+-----+--------+------------+---------------++--+----+-+----+------+---------------+--+-----+-/         ||             |  |  |        
  |     | |     \-----+--------+------------+---------------++--+----+-+----/      |               |  |     |           ||             |  |  |        
  |     | |           |        |            |    /----------++--+----+-+-----------+---------------+--+-----+-----------++----\        |  |  |        
  |     | |           |        |            |    |          \+--+----+-+-----------+---------------+--+-----+-----------/|    |        |  |  |        
  \-----+-+-----------/        |            |    |           \--+----+-+-----------+---------------+--+-----/            |    |        |  |  |        
        | |                    |            \----+--------------+----+-+-----------+---------------+--+------------------+----+--------+--/  |        
        | |                    |                 |              |    | |           \---------------+--+------------------/    |        |     |        
        \-+--------------------+-----------------+--------------+----/ |                           |  |                       |        |     |        
          |                    |                 |              |      \---------------------------/  |                       |        |     |        
          \--------------------/                 |              \-------------------------------------+-----------------------+--------/     |        
                                                 |                                                    \-----------------------+--------------/        
                                                 \----------------------------------------------------------------------------/                       
INPUT;
    }

    public function getAnswer(bool $partTwo): string
    {
        $input = $this->getPuzzleInput();

        $grid = [];
        $carts = [];
        $positions = [];
        $cartID = 0;

        foreach (explode("\n", $input) as $y => $row) {
            foreach (str_split($row) as $x => $char) {
                switch ($char) {
                    case '|':
                    case '\\':
                    case '/':
                    case '-':
                    case '+':
                        $grid[$y][$x] = $char;
                        break;
                    case '>':
                        $carts[] = [
                            'x' => $x,
                            'y' => $y,
                            'direction' => self::RIGHT,
                            'intersections' => 0,
                            'cartID' => $cartID++,
                        ];
                        $grid[$y][$x] = '-';
                        $positions[$y][$x] = 1;
                        break;
                    case 'v':
                        $carts[] = [
                            'x' => $x,
                            'y' => $y,
                            'direction' => self::DOWN,
                            'intersections' => 0,
                            'cartID' => $cartID++,
                        ];
                        $grid[$y][$x] = '|';
                        $positions[$y][$x] = 1;
                        break;
                    case '<':
                        $carts[] = [
                            'x' => $x,
                            'y' => $y,
                            'direction' => self::LEFT,
                            'intersections' => 0,
                            'cartID' => $cartID++,
                        ];
                        $grid[$y][$x] = '-';
                        $positions[$y][$x] = 1;
                        break;
                    case '^':
                        $carts[] = [
                            'x' => $x,
                            'y' => $y,
                            'direction' => self::UP,
                            'intersections' => 0,
                            'cartID' => $cartID++,
                        ];
                        $grid[$y][$x] = '|';
                        $positions[$y][$x] = 1;
                        break;
                }
            }
        }

        $ticks = 0;
        while (count($carts) > 1) {
            $ticks++;
            $this->output->writeln("At the start of tick $ticks, there are " . count($carts));
            $newCarts = [];
            $deadCarts = [];
            foreach ($carts as $index => $cart) {
                $cartID = $cart['cartID'];

                if (in_array($cartID, $deadCarts)) {
                    continue;
                }
                $positions[$cart['y']][$cart['x']]--;

                switch ($cart['direction']) {
                    case self::LEFT:
                        $cart['x']--;
                        break;
                    case self::RIGHT:
                        $cart['x']++;
                        break;
                    case self::UP:
                        $cart['y']--;
                        break;
                    case self::DOWN:
                        $cart['y']++;
                        break;
                }

                switch ($grid[$cart['y']][$cart['x']]) {
                    case '\\':
                        switch ($cart['direction']) {
                            case self::LEFT:
                                $cart['direction'] = self::UP;
                                break;
                            case self::RIGHT:
                                $cart['direction'] = self::DOWN;
                                break;
                            case self::UP:
                                $cart['direction'] = self::LEFT;
                                break;
                            case self::DOWN:
                                $cart['direction'] = self::RIGHT;
                                break;
                        }
                        break;
                    case '/':
                        switch ($cart['direction']) {
                            case self::LEFT:
                                $cart['direction'] = self::DOWN;
                                break;
                            case self::RIGHT:
                                $cart['direction'] = self::UP;
                                break;
                            case self::UP:
                                $cart['direction'] = self::RIGHT;
                                break;
                            case self::DOWN:
                                $cart['direction'] = self::LEFT;
                                break;
                        }
                        break;
                    case '+':
                        if ($cart['intersections'] == 0) {
                            $cart['direction'] = ($cart['direction'] + 1) % 4;
                        } elseif ($cart['intersections'] == 2) {
                            $cart['direction'] = ($cart['direction'] + 3) % 4;
                        }
                        $cart['intersections'] = ($cart['intersections'] + 1) % 3;
                        break;
                }

                if (!isset($positions[$cart['y']][$cart['x']])) {
                    $positions[$cart['y']][$cart['x']] = 1;
                } else {
                    $positions[$cart['y']][$cart['x']]++;

                    if ($positions[$cart['y']][$cart['x']] == 2) {
                        if (!$partTwo) {
                            return $cart['x'] . ',' . $cart['y'];
                        } else {
                            $deadCarts[] = $cartID;

                            // Go through all of the other carts, mark them as dead
                            foreach (array_merge($carts, $newCarts) as $cartsToCheck) {
                                if ($cartsToCheck['x'] == $cart['x'] && $cartsToCheck['y'] == $cart['y']) {
                                    $deadCarts[] = $cartsToCheck['cartID'];
                                }
                            }
                        }
                    }
                }

                $newCarts[] = $cart;
            }

            if (count($deadCarts) > 0) {
                $newCarts = array_filter(
                    $newCarts,
                    function ($cart) use ($deadCarts) {
                        return !in_array($cart['cartID'], $deadCarts);
                    }
                );
            }

            usort(
                $newCarts,
                function ($cartA, $cartB) {
                    if ($cartA['y'] == $cartB['y']) {
                        return $cartA['x'] - $cartB['x'];
                    }
                    return $cartA['y'] - $cartB['y'];
                }
            );
            $carts = $newCarts;
        }


        $cart = reset($carts);
        return $cart['x'] . ',' . $cart['y'];
    }

}
